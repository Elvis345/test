<!DOCTYPE html>
<html>
<head>
	<title>Ping Pong Game</title>
</head>
<body style="margin:0px">
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

		app.onInit = function () {
			console.log("hello");

			this.paused = true;
			this.message = "Press space to start";

			//resize game to fit window
			window.addEventListener('resize', function () {
                app.canvasWidth = window.innerWidth - 4;
                app.canvasHeight = window.innerHeight - 4;

                app.canvas.width = app.width;
                app.canvas.height = app.height;

                let ratio = app.width / app.height;

                if (app.canvasHeight > app.canvasWidth / ratio) {
                    app.canvasHeight = app.canvasWidth / ratio;
                }
                else {
                    app.canvasWidth = app.canvasHeight * ratio;
                }

                app.canvas.style.width = app.canvasWidth + 'px';
                app.canvas.style.height = app.canvasHeight + 'px';
			});

			this.nodes.push({
				id: 'leftPlayer',
				x: app.width / 25,
				y: app.height / 2 - app.height / 14,
				width: app.width / 50,
                height: app.height / 7,
				color: 'black',
				up: 0,
				down: 0,
				score: 0
			});

			this.nodes.push({
				id: 'rightPlayer',
				x: app.width - (app.width / 25 + app.width / 50),
                y: app.height / 2 - app.height / 14,
                width: app.width / 50,
				height : app.height / 7,
				color: 'black',
				up: 0,
				down: 0,
				score: 0
			});

			this.nodes.push({
				id: 'ball',
                x: app.width / 2 - app.width / 100,
                y: app.height / 2 - app.width / 100,
                width: app.width / 50,
                height: app.width / 50,
				color: 'black',
				ySpeed: app.width / 100,
				xSpeed: app.width / 100 - (Math.round(Math.random()) * app.width / 50)
			});

            document.onkeydown = function (event) {
                if (event.keyCode === 87) { //w
                    app.getNode('leftPlayer').up = 1;
                }
                else if (event.keyCode === 83) { //s
                    app.getNode('leftPlayer').down = 1;
                }
                else if (event.keyCode === 38) { //up arrow
                    app.getNode('rightPlayer').up = 1;
                }
                else if (event.keyCode === 40) { //down arrow
                    app.getNode('rightPlayer').down = 1;
                }
                else if (event.keyCode === 32) { //space
					if (app.paused) {
						app.start();
					}
					else {
						app.pause();
					}
                }
			}

            document.onkeyup = function (event) {
                if (event.keyCode === 87) { //w
                    app.getNode('leftPlayer').up = 0;
                }
                else if (event.keyCode === 83) { //s
                    app.getNode('leftPlayer').down = 0;
                }
                else if (event.keyCode === 38) { //up arrow
                    app.getNode('rightPlayer').up = 0;
                }
                else if (event.keyCode === 40) { //down arrow
                    app.getNode('rightPlayer').down = 0;
                }
			}

            this.start = function () {
				app.paused = false;
			}

            this.reset = function () {
				app.paused = true;
                this.message = "Press space to start";

                app.getNode('leftPlayer').x = app.width / 25;
                app.getNode('leftPlayer').y = app.height / 2 - app.height / 14;
                app.getNode('rightPlayer').x = app.width - (app.width / 25 + app.width / 50);
				app.getNode('rightPlayer').y = app.height / 2 - app.height / 14;
                app.getNode('ball').x = app.width / 2 - app.width / 100;
                app.getNode('ball').y = app.height / 2 - app.width / 100;
			}

            this.pause = function () {
				app.paused = true;
				this.message = "Paused";
            }
		};

		app.onUpdate = function (time) {
			if (this.paused) {
				return;
            }

            var playerSpeed = this.height / 50;

			//move players
            this.getNode('leftPlayer').y += playerSpeed * (this.getNode('leftPlayer').down - this.getNode('leftPlayer').up);
            this.getNode('rightPlayer').y += playerSpeed * (this.getNode('rightPlayer').down - this.getNode('rightPlayer').up);

			//prevent players form going outside the boundaries
			if (this.getNode('leftPlayer').y < 0) {
				this.getNode('leftPlayer').y = 0;
			}
			else if (this.getNode('leftPlayer').y + this.getNode('leftPlayer').height > this.height) {
				this.getNode('leftPlayer').y = this.height - this.getNode('leftPlayer').height;
			}

			if (this.getNode('rightPlayer').y < 0) {
				this.getNode('rightPlayer').y = 0;
			}
            else if (this.getNode('rightPlayer').y + this.getNode('rightPlayer').height > this.height) {
                this.getNode('rightPlayer').y = this.height - this.getNode('rightPlayer').height;
			}

			//move ball
			this.getNode('ball').y += this.getNode('ball').ySpeed;
            this.getNode('ball').x += this.getNode('ball').xSpeed;

			//ball boundaries
            if (this.getNode('ball').y < 0 || this.getNode('ball').y + this.getNode('ball').height > this.height) {
                this.getNode('ball').ySpeed *= -1;
			}
			if (this.getNode('ball').x < 0) {
                this.getNode('rightPlayer').score++;
				console.log('left player : ' + this.getNode('leftPlayer').score + ' right player : ' + this.getNode('rightPlayer').score);
				this.scoreMessage = (this.getNode('leftPlayer').score + " : " + this.getNode('rightPlayer').score);
				this.reset();
			}
			else if (this.getNode('ball').x + this.getNode('ball').width > this.width) {
				this.getNode('leftPlayer').score++;
				console.log('left player : ' + this.getNode('leftPlayer').score + ' right player : ' + this.getNode('rightPlayer').score);
                this.scoreMessage = (this.getNode('leftPlayer').score + " : " + this.getNode('rightPlayer').score);
				this.reset();
			}

			//ball collision with players
			if (this.getNode('ball').x <= (this.getNode('leftPlayer').x + this.getNode('leftPlayer').width) &&
				this.getNode('ball').x >= (this.getNode('leftPlayer').x - this.getNode('ball').width) &&
				this.getNode('ball').y <= (this.getNode('leftPlayer').y + this.getNode('leftPlayer').height) &&
				this.getNode('ball').y >= (this.getNode('leftPlayer').y - this.getNode('ball').height)) {

				this.getNode('ball').xSpeed = Math.abs(this.getNode('ball').xSpeed);
			}
			else if (this.getNode('ball').x <= (this.getNode('rightPlayer').x + this.getNode('rightPlayer').width) &&
				this.getNode('ball').x >= (this.getNode('rightPlayer').x - this.getNode('ball').width) &&
				this.getNode('ball').y <= (this.getNode('rightPlayer').y + this.getNode('rightPlayer').height) &&
				this.getNode('ball').y >= (this.getNode('rightPlayer').y - this.getNode('ball').height)) {

				this.getNode('ball').xSpeed = -1 * Math.abs(this.getNode('ball').xSpeed);
            }
		};
	</script>
</body>
</html>